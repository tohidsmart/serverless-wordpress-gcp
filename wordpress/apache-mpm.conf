# Apache MPM Prefork Configuration
# Optimized for Cloud Run: 2 vCPU, 1GB RAM
# Target: ~20 concurrent workers @ 45MB each = 900MB

<IfModule mpm_prefork_module>
    # Start with 2 servers for faster initial response
    StartServers             2

    # Keep 2-5 idle servers ready to handle burst traffic
    MinSpareServers          2
    MaxSpareServers          5

    # Maximum concurrent workers (tuned for 1GB RAM)
    # Each worker ~45MB (with OPcache) = 20 workers Ã— 45MB = 900MB
    MaxRequestWorkers        20

    # Maximum requests per child before recycling (prevents memory leaks)
    MaxConnectionsPerChild   1000

    # ServerLimit must be >= MaxRequestWorkers
    ServerLimit              20
</IfModule>

# Connection timeout settings (Cloud Run optimized)
Timeout 60
KeepAlive On
KeepAliveTimeout 5
MaxKeepAliveRequests 100

# Reduce memory usage for request handling
LimitRequestBody 10485760
LimitRequestFields 100
LimitRequestFieldSize 8190
LimitRequestLine 8190
